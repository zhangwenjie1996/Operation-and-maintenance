<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet"
          href="../../src/css/quote/themes/default/style.min.css"/>
    <link rel="stylesheet"
          href="../../src/css/quote/lib/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet"
          href="../../src/css/quote/lib/font-awesome-4.6.3/css/font-awesome.min.css">
    <link href="../../src/css/quote/lib/jquery.bootgrid.min.css"
          rel="stylesheet"/>
          <!-- alert -->
	<link rel="stylesheet" type="text/css" href="../../src/alert/sweetalert2.min.css">
    <link href="../../src/css/common.css" rel="stylesheet" type="text/css">
    <!--<script type="text/javascript" src="dist/js/jquery.i18n.properties-1.0.9.js"></script>-->
    <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <script src="//cdn.bootcss.com/html5shiv/r29/html5.min.js"></script>
    <![endif]-->


    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script type="text/javascript"
            src="../../src/js/quote/jquery-1.11.1.min.js"></script>

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script type="text/javascript"
            src="../../src/js/quote/bootstrap/js/bootstrap.min.js"></script>

</head>
<body>
<div class="row deviceM">
    <ol class="breadcrumb path-navigation special-path">
        <li><a href="deviceAccessories.html">型号管理</a></li>
        <li class="active">型号信息</li>
    </ol>

    <div class="col-sm-12 col-md-12 col-lg-12">
        <div class="device-list-row ">
            <ol class="breadcrumb">
                <li><a><i></i>配件信息</a></li>
            </ol>
            <button class="addBtn1 btn btn-primary btn-sm" type="button"><i class="fa fa-plus"></i>新增
            </button>
             <div class="table-rp">
            <table id="grid-data1"
                   class="table table-condensed table-hover table-striped">
                <thead>
                <tr>
                    <!--<th data-column-id="id" data-identifier="true" data-type="numeric">Article ID</th>-->
                    <th data-column-id="materialModelID" data-order="desc" data-visible="false">ID</th>
                    <th data-column-id="materialRelationID" data-order="materialRelationID" data-visible="false">配件所属设备</th>
                    <th data-column-id="materialModelName" data-order="desc">型号名称</th>
                    <th data-column-id="materialModelCode" data-order="desc"> 型号编码</th>
<!--                     <th data-column-id="materialCategoryID" data-order="desc"> 类型</th> -->
<!--                     <th data-column-id="unitnName" data-order="desc"> 单位</th> -->
<!--                     <th data-column-id="supMaterialModelID" data-order="desc"> 配件所属设备</th> -->
                    <th data-column-id="maxInventory" data-order="desc">最大库存</th>
                    <th data-column-id="minInventory" data-order="desc"> 最小库存</th>
                    <th data-column-id="providerName" data-order="desc">供应商名</th>
                    <th data-column-id="description" data-order="desc">描述</th>
                    <th data-column-id="commands" data-formatter="commands"
                        data-sortable="false">Commands
                    </th>
                </tr>
                </thead>
            </table>
            </div>
        </div>
    </div>
</div>


<!-- cd-popup-container-start -->
<div class="cd-popup1" role="alert">
    <div class="cd-popup-container" style="max-width:100%;width:100%;">
        <a class="cd-popup-close icon-close fa fa-times"></a>

        <div class="tabbar"></div>
        <div class="mnk"  >
        <div class="one">
            <div class="col-sm-4 col-md-3 col-lg-3">
                <div class="row-tree-menu">
                    <ol class="breadcrumb">
                        <li><a href="#">类型列表</a></li>
                    </ol>
                    <ol class="breadcrumb path-navigation">
                        <li><a href="#">当前类型</a></li>
                        <li class="active" id="currentDepart"></li>
                    </ol>
                    <div class="search-tree">
                        <input type="text" class="form-control" id="search-tree"
                               placeholder="搜索">
                    </div>

                    <div id="ajax" class="demo"></div>
                </div>
            </div>
            <div class="col-sm-8 col-md-9 col-lg-9">
                <div class="device-filter-row">
                    <ol class="breadcrumb">
                        <li><a><i></i>筛选条件</a></li>
                    </ol>
 
                    <form class="form-horizontal  form-common filter-criteria" role="form" id="filter-criteria">
                        <div class="form-group col-xs-11 col-sm-11 col-md-6 col-lg-4">
                            <label class=" col-sm-5 control-label" for="p_materialModelName">型号名称</label>
                              <div class="col-sm-7">
 
                            <input type="text" class="form-control" id="p_materialModelName"
                                   placeholder=" " name="materialModelName">
                                   </div>
                        </div>
                        <div class="form-group col-xs-11 col-sm-11 col-md-6 col-lg-4">
                            <label class=" col-sm-5 control-label" for="p_materialModelCode">型号编号</label>
                              <div class="col-sm-7">
                            <input type="text" class="form-control" id="p_materialModelCode"
                                   placeholder=" " name="materialModelCode">
                                   </div>
                        </div>
                        <div class="form-group col-xs-11 col-sm-11 col-md-6 col-lg-4">
                            <label class=" col-sm-5 control-label" for="p_providerName">供应商</label>
                              <div class="col-sm-7">
                            <input type="text" class="form-control" id="p_providerName"
                                   placeholder=" " name="providerName">
                                   </div>
                        </div>
                        <button type="button" class="searchBtn btn btn-primary">查询</button>
                    </form>
                </div>
                <div class="device-list-row">
                    <ol class="breadcrumb">
                        <li><a><i></i>型号列表</a></li>
                    </ol>
                    <button type="button" class="btn btn-primary" onclick="skip()">型号管理</button>
                    <table id="grid-data"
                           class="table table-condensed table-hover table-striped">
                        <thead>
                        <tr>
                            <th data-column-id="materialModelID" data-identifier="true" data-type="numeric"
                                data-visible="false">型号ID
<!--                             <th data-column-id="supMaterialModelID" data-identifier="true" data-type="numeric" -->
<!--                                 data-visible="false">supMaterialModelID -->
<!--                             </th> -->
<!--                             <th data-column-id="materialCategoryID" data-order="desc" data-visible="false"> -->
<!--                                 materialCategoryID -->
<!--                             </th> -->
<!--                             <th data-column-id="supMeterialModelID" data-order="desc" data-visible="false"> -->
<!--                                 supMeterialModelID -->
<!--                             </th> -->
                            <th data-column-id="materialModelName" data-order="desc">型号名称
                            </th>
                            <th data-column-id="materialModelCode" data-order="desc">型号编码</th>
                            <th data-column-id="maxInventory" data-order="desc">最大库存</th>
                            <th data-column-id="minInventory" data-order="desc">最小库存</th>
                            <th data-column-id="providerID" data-order="desc">供应商ID</th>
                            <th data-column-id="providerName" data-order="desc">供应商名称</th>
<!--                             <th data-column-id="commands" data-formatter="commands" -->
<!--                                 data-sortable="false">Commands -->
<!--                             </th> -->
                        </tr>
                        </thead>
                    </table>
                    <!--          <button   class="saveBtn btn btn-primary btn-sm" type="button" ><i class="fa fa-plus"></i>保存</button> -->
                </div>
            </div>
            <div class="cd-buttons">
                <button type="button"
                        class="btn btn-primary cd-popup-close cd-btn cd-btn-save">保存
                </button>
                <button type="button"
                        class="btn btn-danger cd-popup-close cd-btn cd-btn-deal">取消
                </button>
            </div>
       </div>
       <div class="two">
            <form id="formDevice" class="form-horizontal form-block">
                <div class="form-group">
                    <label for="materialModelName" class="col-sm-2 control-label">型号名称</label>

                    <div class="col-sm-10">
                        <input class="form-control" id="materialModelName" placeholder="materialModelName"
                               name="materialModelName">
                        <input class="form-control" id="materialModelID" placeholder="materialModelID"
                               name="materialModelID" type="hidden">
                    </div>
                </div>
                <div class="form-group" >
                    <label for="materialModelCode" class="col-sm-2 control-label">型号编码</label>

                    <div class="col-sm-10">
                        <input class="form-control" id="materialModelCode" placeholder="materialModelCode" name="materialModelCode">
                    </div>
                </div>
                <div class="form-group" hidden="hidden">
                    <label for="materialCategoryID" class="col-sm-2 control-label">类型</label>

                    <div class="col-sm-10">
                        <input class="form-control" id="materialCategoryID" placeholder="materialCategoryID" name="materialCategoryID">
                    </div>
                </div>
<!--                 <div class="form-group"> -->
<!--                     <label for="groupCode" class="col-sm-2 control-label">配件所属设备</label> -->

<!--                     <div class="col-sm-10"> -->
<!--                         <input class="form-control" id="groupCode" placeholder="postname" name="groupCode"> -->
<!--                     </div> -->
<!--                 </div> -->
                <div class="form-group">
                    <label for="maxInventory" class="col-sm-2 control-label">最大库存</label>

                    <div class="col-sm-10">
                        <input class="form-control" id="maxInventory" placeholder="maxInventory"
                               name="maxInventory">
                    </div>
                </div>
                <div class="form-group">
                    <label for="minInventory" class="col-sm-2 control-label">最小库存</label>

                    <div class="col-sm-10">
                        <input class="form-control" id="minInventory" placeholder="minInventory" name="minInventory">
                    </div>
                </div>
                <div class="form-group">
                    <label for="providerName" class="col-sm-2 control-label">供应商名</label>

                    <div class="col-sm-10">
                        <input class="form-control" id="providerName" placeholder="providerName" name="providerName">
                    </div>
                </div>
                <div class="form-group">
                    <label for="description" class="col-sm-2 control-label">描述</label>

                    <div class="col-sm-10">
                        <input class="form-control" id="description" placeholder="description" name="description">
                    </div>
                </div>
            </form>
            <div class="cd-buttons">
                <button type="button"
                        class="btn btn-primary cd-popup-close cd-btn cd-btn-save">保存
                </button>
                <button type="button"
                        class="btn btn-danger cd-popup-close cd-btn cd-btn-deal">取消
                </button>
            </div>
       </div>
        </div>
    </div>
    <!-- cd-popup-container-end -->
</div>
<script src="../../src/alert/sweetalert2.min.js"></script> 
	<!-- for IE support -->
	<script src="../../src/alert/es6-promise.auto.min.js"></script>
<script src="http://cdn.gbtags.com/jqueryui/1.10.4/jquery-ui.min.js"></script>
<script src="../../src/js/quote/jquery.bootgrid.js"></script>
<script src="../../src/js/quote/jquery.bootgrid.fa.min.js"></script>
<script src="../../src/js/quote/moderniz.2.8.1.js"></script>
<script src="../../src/js/quote/jstree.js"></script>
<script src="../../src/js/packtreegrid/pack2.js"></script>
<script src="../../src/js/dialog/dialog2.js"></script>
<script src="../../src/js/ajaxurl/ajax.js"></script>
<script src="../../src/js/curd/curd.js"></script>
<script src="../../src/js/grid/grid.js"></script>
<script>

    var flag, materialModelCode;
    var id = localStorage.getItem("id");
    var parentID = localStorage.getItem("parentID");
 var $two = $(".two .cd-btn-save");
    var f1 = gridFn("../../MaterialModelController/findSupMaterialModelID?supMaterialModelID=" + id, "grid-data1", "materialModelID", function () {
        $(".addBtn1").on("click", function (e) {
        	$(".one").show();
        	$(".two").hide();
            $(".tabbar").html("添加");
            $().dia("cd-popup1");
        });
    }, function (n) { 
    	var param={materialRelationID:$(n).attr("p")};
    	console.log($(n).attr("p"));
//      curd.delBtn("../../MaterialRelationController/delete", n)
curd.ajax("../../MaterialRelationController/delete","get",param,true, function (data) {
    $(n).parents('tr').remove();
}, function (data) {
	swal({text:data.message});
})
    }, function (n) {
        $().dia("cd-popup1");
        $(".two").show();
    	$(".one").hide();
        $(".tabbar").html("编辑");
        $(".two").find('.cd-buttons').show();
        var param = {
            id: $(n).attr("data-row-id"),
       
        }
        curd.showInfo("../../MaterialModelController/findById?", "get", param,true);
        $two.off("click");
        $two.on("click", function (e) {
        	   var arr = $(".cd-popup1 #formDevice").serialize();
               curd.saveBtn("grid-data1","../../MaterialModelController/update", "post",arr,true);
       })
   

    }, function (n) {
        $().dia2("cd-popup1");
        $(".two").show();
    	$(".one").hide();
        $(".tabbar").html("查看");
  
        $(".two").find('.cd-buttons').hide();
        var param = {
            id: $(n).attr("data-row-id")
        }
        curd.showInfo("../../MaterialModelController/findById" , "get", param,true);
        
    })
 
</script>
<script>
//新增配件tree列表
    var storageID = "", deviceArea = [];
    $.ajax({
        async: false,
        url: "../../MaterialCategoryController/findCategoryTree",
        type: "get",
        success: function (data) {
            var jsonData = JSON.parse(data);
            callBack(jsonData.data);
        }
    });
    function callBack(data) {
        var treeid = "ajax";
        var tree = $("#" + treeid);
        var inst, clickedNode;
        var $save = $("#save");
        var reg = /^j1_(\d+)/;
        tree.jstree(false);
        pack.showCheckboxTree(
                data,
                treeid,
                "blue  fa fa-sitemap",
                "search-tree",
                ["dnd", "search", "state", "types", "wholerow", "contextmenu", "checkbox"
                ], false,
                false,
                null).bind("activate_node.jstree", function (e, data) {
                    var materialCategoryID = data.node.id;
                    var cur = data.node;
                    $("#currentDepart").html(cur.text);
                    $("#p_materialCategoryID").val(materialCategoryID);
                    planningFilter("../../MaterialModelController/findMultiCondition?materialCategoryID=" + materialCategoryID, "grid-data");
                })

    }
</script>
<script>
//新增配件grid选择
    var rowIds = [], store = {};
    var planningFilter = function (url, container) {
        pack.gridInit(url, container).on("selected.rs.jquery.bootgrid", function (e, rows) {
            $.each(rows, function (index, item) {
                item.patrolGroupID = sessionStorage.getItem("id");
                rowIds.push(item);
            });
            console.log(JSON.stringify(rowIds));
        }).on("deselected.rs.jquery.bootgrid", function (e, rows) {
            $.each(rows, function (index, item) {
                item.patrolGroupID = sessionStorage.getItem("id");
                var index = $.inArray(item, rowIds);
                console.log(index);
                rowIds.splice(index, 1);
            });
            console.log(rowIds);
        });
    };

    var $one = $(".one .cd-btn-save");
    $one.off("click");
    $one.on("click", function (e) {
      
        console.log(rowIds);
       // store = {employeeCommands: rowIds};
       // $.param(store, true);
       // var data = JSON.stringify(store);
        var rIds=[];
        var fuid = localStorage.getItem("id");
        $.each(rowIds,function(index,item){
        	var item2={};
        	item2.materialModelID=item.materialModelID;
        	item2.supMaterialModelID=fuid;
        	rIds.push(item2);
        });
        $.ajax({
            type: "post",
            method: "post",
            contentType : 'application/json;charset=utf-8',
            url: "../../MaterialRelationController/add",
            dataType: "json",
            data: JSON.stringify(rIds),
            success: function (data) {
            	$("#grid-data1").bootgrid("reload")
            }
        });

        rowIds = []
    })
</script>
 <script> 
 //查询
     $(".filter-criteria button").on("click", function () {
         var arr = $("#filter-criteria").serialize() ;
         console.log(arr);
        planningFilter("../../MaterialModelController/findMultiCondition?"+arr,"grid-data")
    });
   
 </script> 

</body>
</html>