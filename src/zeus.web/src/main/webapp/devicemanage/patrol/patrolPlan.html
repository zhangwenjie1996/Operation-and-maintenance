<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="../../src/css/quote/themes/default/style.min.css"/>
    <link rel="stylesheet" href="../../src/css/quote/lib/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="../../src/css/quote/lib/bootstrap-datetimepicker-master/css/bootstrap-datetimepicker.min.css"/>
    <link rel="stylesheet" href="../../src/css/quote/lib/font-awesome-4.6.3/css/font-awesome.min.css">
    <link href="../../src/css/quote/lib/jquery.bootgrid.min.css" rel="stylesheet"/>
        <!-- alert -->
	<link rel="stylesheet" type="text/css" href="../../src/alert/sweetalert2.min.css">
    <link href="../../src/css/common.css" rel="stylesheet" type="text/css">

    <!--<script type="text/javascript" src="dist/js/jquery.i18n.properties-1.0.9.js"></script>-->
    <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <script src="//cdn.bootcss.com/html5shiv/r29/html5.min.js"></script>
    <![endif]-->
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script type="text/javascript" src="../../src/js/quote/jquery-1.11.1.min.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script type="text/javascript" src="../../src/js/quote/bootstrap/js/bootstrap.min.js"></script>
</head>
<body>
<div class="row patrolP">
    <div class="col-sm-12 col-md-12 col-lg-12">
        <div class=" common-filter">
            <ol class="breadcrumb">
                <li><a><i class="fa fa-search"></i>搜索</a></li>
            </ol>

            <form class="form-horizontal  form-common" role="form"  id="searchForm"  >
                <div class="form-group col-xs-11 col-sm-6 col-md-4 col-lg-3">
                    <label for="patrolGroupID" class="col-sm-5  control-label">巡检小组</label>
                      <div class="col-sm-7">
                    <select class="form-control" id="p_patrolGroupID" class="form-control" name="patrolGroupID">
                      <option value="">-请选择-</option> 
                    </select>   
                    </div>
                </div>
                <div class="form-group col-xs-11 col-sm-6 col-md-4 col-lg-3">
                    <label for="patrolRouteID" class="col-sm-5  control-label">巡检路线</label>
                      <div class="col-sm-7">
                         <select class="form-control"  id="p_patrolRouteID"class="form-control" name="patrolRouteID">
                    <option value="">-请选择-</option>
                    </select>    
                    </div>
                </div>
                <div class="form-group col-xs-11 col-sm-6 col-md-4 col-lg-3">
                    <label for="start" class="col-sm-5  control-label">巡检开始时间</label>
                       <div class="col-sm-7">
                   <input size="16" type="text" class="form-control form_datetime" id="p_start" placeholder="" name="start">
                   </div>
                </div>
                <div class="form-group col-xs-11  col-sm-6 col-md-4 col-lg-3">
                    <label for="end" class="col-sm-5  control-label">巡检结束时间</label>
                      <div class="col-sm-7">
                    <input size="16"  type="text" class="form-control form_datetime" id="p_end" placeholder="" name="end">
                    </div>
                </div>
                <div class="form-group col-xs-11 col-sm-6 col-md-4 col-lg-3">
                    <label for="period" class="col-sm-5  control-label">周期(天)</label>
                       <div class="col-sm-7">
                    <input type="text" class="form-control" id="p_period" placeholder="" name="period">
                    </div>
                </div>
                <button type="button" class="searchBtn btn btn-primary"><i class="fa fa-search"></i>查询</button>
            </form>
            
        </div>
        <div class="user-list-row">
            <div class="tit">
                <ol class="breadcrumb">
                    <li><a><i class="fa  fa-tasks"></i>巡检计划列表</a></li>
                </ol>
                
            </div>
            <button class="addBtn btn btn-primary btn-sm"  type="button"> <i class="fa fa-plus"></i>增加
            </button>
             <div class="table-rp">
         <table id="grid-data" class="table table-condensed table-hover table-striped bootgrid-table" >
                <thead>
                <tr>
                    <!--data-identifier="true"id-->
                    <th data-column-id="patrolPlanID" data-identifier="true" data-type="numeric" data-visible="false">ID</th>
                     <th data-column-id="patrolPlanName">巡检名称</th>
                    <th data-column-id="patrolGroupName">巡检小组</th>
                    <th data-column-id="patrolRouteName">巡检路线</th>
                    <th data-column-id="start">开始时间</th>
                    <th data-column-id="end">结束时间</th>
                    <th data-column-id="taskStartTime">任务开始时间</th>
                    <th data-column-id="taskEndTime">任务结束时间</th>
                    <th data-column-id="period">周期(天)</th>
                    <th data-column-id="availability">是否有效</th>
                    <th data-column-id="description">备注</th>
                    <th data-column-id="commands" data-formatter="commands" data-sortable="false">Commands</th>
                </tr>
                </thead>
            </table>
            </div>
        </div>
    </div>
</div>
<!-- cd-popup-container-start -->
<div class="cd-popup" role="alert">
    <div class="dialog cd-popup-container">
        <a class="cd-popup-close icon-close fa fa-times"></a>
<div class="tabbar"></div>
<div class="mnk">
        <form id="form2" class="form-horizontal form-block" role="form">
            <!--             <div class="form-group col-sm-6"> -->
            <!--                 <label for="employeeid" class="col-sm-4 control-label">ID</label> -->

            <!--                 <div class="col-sm-8"> -->
            <!--                     <input class="form-control" id="employeeid" placeholder="ID" -->
            <!--                            name="employeeid" readonly="readonly"> -->
            <!--                 </div> -->
            <!--             </div> -->
            <input  type="hidden"  id="patrolPlanID" name="patrolPlanID" /> 
            <div class="form-group col-sm-6">
                <label for="patrolPlanName" class="col-sm-5 control-label">计划名称</label>

                <div class="col-sm-7"> 
                    <input size="16"  type="text" class="form-control" id="patrolPlanName" placeholder=" " name="patrolPlanName">
                </div>
            </div>
            <div class="form-group col-sm-6">
                <label for="patrolGroupID" class="col-sm-5 control-label">巡检小组</label>

                <div class="col-sm-7">
                    <select class="form-control" id="patrolGroupID" class="form-control" name="patrolGroupID">
<!--                         <option>-请选择-</option> -->
                    </select>

                </div>
            </div>
            <div class="form-group col-sm-6">
                <label for="patrolRouteID" class="col-sm-5 control-label">巡检路线</label>

                <div class="col-sm-7">
                    <select class="form-control" id="patrolRouteID" class="form-control" name="patrolRouteID">
<!--                         <option>-请选择-</option> -->
                    </select>
                </div>
            </div>
         
            <div class="form-group col-sm-6">
                <label for="start" class="col-sm-5 control-label">开始时间</label>

                <div class="col-sm-7"> 
                    <input size="16"  type="text" class="form-control form_datetime" id="start" placeholder=" " name="start">
                </div>
            </div>
            <div class="form-group col-sm-6">
                <label for="end" class="col-sm-5 control-label">结束时间</label>

                <div class="col-sm-7">
                    <input  size="16"  type="text" class="form-control form_datetime" id="end" placeholder="" name="end">
                </div>
            </div>
            <div class="form-group col-sm-6">
                <label for="taskStartTime" class="col-sm-5 control-label">任务开始时间</label>

                <div class="col-sm-7"> 
                    <input size="16"  type="text" class="form-control form_taskdatetime" id="taskStartTime" placeholder=" " name="taskStartTime">
                </div>
            </div>
            <div class="form-group col-sm-6">
                <label for="taskEndTime" class="col-sm-5 control-label">任务结束时间</label>

                <div class="col-sm-7">
                    <input  size="16"  type="text" class="form-control form_taskdatetime" id="taskEndTime" placeholder="" name="taskEndTime">
                </div>
            </div>
            <div class="form-group col-sm-6">
                <label for="period" class="col-sm-5 control-label">周期(天)</label>

                <div class="col-sm-7">
                    <input class="form-control" id="period" placeholder="周期(天)" name="period">
                </div>
            </div>
           
            <div class="form-group col-sm-6">
                 <label for="availability" class="col-sm-5 control-label">有效性</label>
                        <div class="col-sm-7">
                            <select class="form-control" id="availability" name="availability">
								<option value="1">有</option>
								<option value="0">无</option>
							</select>
                        </div>
            </div>
            <div class="form-group col-sm-6">
                <label for="description" class="col-sm-5 control-label">备注</label>

                <div class="col-sm-7">
                    <textarea class="form-control" id="description" placeholder="备注" name="description"></textarea>
                </div>
            </div>
        </form>
        <div class="cd-buttons">
            <button type="button" class="btn btn-primary cd-popup-close cd-btn cd-btn-save">保存</button>
            <button type="button" class="btn btn-danger cd-popup-close cd-btn cd-btn-deal">取消</button>
        </div>
    </div></div>
    <!-- cd-popup-container-end -->
</div>
<script src="../../src/alert/sweetalert2.min.js"></script> 
<!-- for IE support -->
<script src="../../src/alert/es6-promise.auto.min.js"></script>
<script src="../../src/css/quote/lib/bootstrap-datetimepicker-master/js/bootstrap-datetimepicker.min.js"></script>
<script src="../../src/css/quote/lib/bootstrap-datetimepicker-master/locals/bootstrap-datetimepicker.zh-CN.js"></script>
 <script src="../../src/js/quote/jquery.ui.min.js"></script>
<script src="../../src/js/quote/jquery.bootgrid.js"></script>
<script src="../../src/js/quote/jquery.bootgrid.fa.min.js"></script>
<script src="../../src/js/quote/moderniz.2.8.1.js"></script>
<script src="../../src/js/quote/jstree.min.js"></script>
<script src="../../src/js/packtreegrid/pack2.js"></script>
<script src="../../src/js/dialog/dialog.js"></script>
<script src="../../src/js/curd/curd2.js"></script>
 <script type="text/javascript" src="../../src/js/draggable/draggable.js"></script>
<script>
$(".searchBtn").on("click", function (e) {
	  var arr = $("#searchForm").serialize() ;
planningFilter("../../PatrolPlan/findByPlan?"+arr);
});
    var planningFilter = function (url) {
        $(".addBtn").on("click", function (e) {
            $("#form2 input").val("");
            $().dia(e);
            $(".tabbar").html("增加");
            curd.cdBtnSave('../../PatrolPlan/addPlan','grid-data','#form2');
//             $(".cd-btn-save").off("click");
//             $(".cd-btn-save").on("click", function (e) {
//                 var arr = $("#form2").serialize();
//                 $.post('PatrolPlan/addPlan', arr, function (data) {
//                 	   $("#grid-data").bootgrid("reload");
//                     if (data.state == "Success") {
//                         alert(data.message)
//                     } else {
//                         alert(data.message)
//                     }
//                 }, 'json')
//             });
        });
        // NOTE: I have multiple types of basic filters.
        // eg: Planning, Approved, Completed
        $("#grid-data").bootgrid("destroy");
        var idname="patrolPlanID";
        var formatters= {
                "commands": function (column, row) {
                    return "<a abs=\"查看\" class=\"btn-color btn btn-xs btn-default command-view\"  data-row-id=\"" + row[idname] + "\"><span class=\"fa  fa-eye\"></span></a>"
                            + "<a  abs=\"编辑\" class=\"btn-color btn btn-xs btn-default command-edit\"  data-row-id=\"" + row[idname] + "\"><span class=\"glyphicon glyphicon-pencil\"></span></a> " +
                            "<a  abs=\"删除\" class=\"btn-color btn btn-xs btn-default command-delete\"  data-row-id=\"" + row[idname] + "\"><span class=\"glyphicon glyphicon-trash\"></span></a>";
                },
                
            };

         var grid=pack.gridInit(url, "grid-data",formatters).on("loaded.rs.jquery.bootgrid", function () {
        	 $("tr").each(function (index, item) {

                 var text = $($(item).find("td")[9]);
                 if (text.text() == 0) {
                     text.text("失效");
                 }
                 if (text.text() == 1) {
                     text.text("有效");
                 }
             })

        	 
        	 $().tip();
            /* Executes after data is loaded and rendered */
            grid.find(".command-delete").on("click", function (e) {
                var _this = this;
            	swal({text: "删除第"+$(this).attr("data-row-id")+"行"})
                $.get("../../PatrolPlan/deletePlan", {
                	patrolPlanID: $(this).attr("data-row-id")
                }, function (data) {
                    $(_this).parents('tr').remove();
                }, 'json');
            }).end().find(".command-edit").on("click", function (e) {
//               	sel("patrolGroupID","../../PatrolGroup/findAllGroup"); 
//               	sel("patrolRouteID","../../PatrolGroup/findAllGroup") 
            	  $(".tabbar").html("编辑");
                $().dia(e);
                $.get('../../PatrolPlan/findByPlanId', {patrolPlanID: $(this).attr("data-row-id")}, function (data) {
                	 
                	var d = data.data;
                    for (key in d) {
                    	 $("#" + key).val(d[key])
                    }
                }, 'json');
                $(".cd-btn-save").off("click");
                $(".cd-btn-save").on("click", function (e) {
                    var arr = $("#form2").serialize();
                    $.post('../../PatrolPlan/updatePlan', arr, function (data) {
                        if (data.state == "Success") {
                        	swal({text: data.message}) 
                        } else {
                        	swal({text: data.message})
                        }
                    }, 'json')
                });
            }).end().find(".command-view").on("click", function (e) {
            	 
            	  
            	  $(".tabbar").html("查看");
                $().dia2(e);
                
                $.post('../../PatrolPlan/findByPlanId', {patrolPlanID: $(this).attr("data-row-id")}, function (data) {
                	var d = data.data;                	 
                    for (var key in d) {
                     $("#" + key).val(d[key]);
                    }
                }, 'json');
            }).end().find(".command-account").on("click", function (e) {
                $('#myModal').modal();
                $("#form1")[0].reset();
                $('.readInput').val($(this).attr("data-row-id"));
                $.post('../../PatrolPlan/findByAccountEmployeeId', {patrolPlanID: $(this).attr("data-row-id")}, function (data) {
                	var d = data.data;
                	if(d!= undefined){
	                    for (key in d) {
	                    	 $("#" + key).val(d[key])
	                    }
                	}
                    $("#saveAccount").off("click");
                    $("#saveAccount").on("click", function () {
                        var arr = $("#form1").serialize();
                        var url = "";
                        if( d == undefined ||""==data.data.accountId){
                        	//若为空则是add
                        	url = "../../PatrolPlan/addAccount";
                        }else{
                        	url = "../../PatrolPlan/updateAccount";
                        }
                        $.post(url, arr, function (data) {
                        	 if (data.state == "Success") {
                        			swal({text: data.message})
                             } else {
                            		swal({text: data.message})
                             }
                        });
                    })
                }, 'json');

            })
        });
    };

   planningFilter("../../PatrolPlan/findPlanByPageDate");
</script>
<script>
    $(window).on("resize", resize);
    function resize() {
        $(".unit-tree").width($("#unit").width());
    }
    resize();
    $(".drop-down-unit").on("click", function () {
        $(".unit-tree").toggle();
    })
</script>
<script>
function sel(container,url,patrolID,patrolName){
		$.getJSON(url, function (data) {
//$("#patrolGroupID").append($("<option/>").text("-请选择-"));
         $.each(data.data, function (index, item) { 

             $("#"+container).append("<option value='"+item[patrolID]+"'>"+item[patrolName]+"</option>");
            console.log(item[patrolName])
         });
	}) 	
}	
   sel("patrolGroupID","../../PatrolGroup/findAllGroup","id","text") ;
   sel("patrolRouteID","../../PatrolRoute/findRouteTree","id","text") ;
   sel("p_patrolGroupID","../../PatrolGroup/findAllGroup","id","text") ;
   sel("p_patrolRouteID","../../PatrolRoute/findRouteTree","id","text") ;
	 
</script>
<script type="text/javascript">
//时间控件
 $(".form_datetime").datetimepicker({format: 'yyyy-mm-dd hh:ii:ss',  language:  'zh-CN',autoclose:'true',todayHighlight:'true',showMeridian:'true'});
 $(".form_taskdatetime").datetimepicker({format: 'hh:ii:ss',  language:  'zh-CN',autoclose:'true',todayHighlight:'true',showMeridian:'true'});

</script>
</body>
</html>